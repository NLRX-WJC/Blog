(window.webpackJsonp=window.webpackJsonp||[]).push([[111],{528:function(s,a,n){"use strict";n.r(a);var t=n(12),e=Object(t.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"数据卷"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数据卷"}},[s._v("#")]),s._v(" 数据卷")]),s._v(" "),a("p",[a("code",[s._v("数据卷")]),s._v(" 是一个可供一个或多个容器使用的特殊目录：")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("数据卷")]),s._v(" 可以在容器之间共享和重用；")]),s._v(" "),a("li",[s._v("对 "),a("code",[s._v("数据卷")]),s._v(" 的修改会立即生效；")]),s._v(" "),a("li",[s._v("对 "),a("code",[s._v("数据卷")]),s._v(" 的更新，不会影响镜像；")]),s._v(" "),a("li",[a("code",[s._v("数据卷")]),s._v(" 默认会一直存在，即使容器被删除；")])]),s._v(" "),a("p",[s._v("在命令行中可以使用 "),a("code",[s._v("docker volume --help")]),s._v(" 来查看数据卷相关的命令，如下：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" volume "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--help")]),s._v("\n\nUsage:  "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" volume COMMAND\n\nManage volumes\n\nCommands:\n  create      Create a volume  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建一个数据卷")]),s._v("\n  inspect     Display detailed information on one or "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("more")]),s._v(" volumes  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 显示数据卷详情")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("          List volumes  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 列出所有的数据卷")]),s._v("\n  prune       Remove all unused "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("local")]),s._v(" volumes  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除所有的未正在使用的数据卷")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v("          Remove one or "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("more")]),s._v(" volumes  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除一个或多个数据卷")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[s._v("下面我们就来实操一下这些命令。")]),s._v(" "),a("h2",{attrs:{id:"命令实操"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#命令实操"}},[s._v("#")]),s._v(" 命令实操")]),s._v(" "),a("p",[a("strong",[s._v("创建一个数据卷：")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("~ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" volume create nlrx\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("strong",[s._v("查看所有数据卷：")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("~ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" volume "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 输出")]),s._v("\nDRIVER    VOLUME NAME\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("local")]),s._v("     nlrx\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[a("strong",[s._v("查看指定数据卷的信息：")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v(" ~ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" volume inspect nlrx\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"CreatedAt"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2022-01-16T15:24:43Z"')]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Driver"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"local"')]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Labels"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Mountpoint"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/var/lib/docker/volumes/nlrx/_data"')]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Name"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nlrx"')]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Options"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Scope"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"local"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[s._v("其中， "),a("code",[s._v("Mountpoint")]),s._v(" 就是该数据卷在本机中的物理位置。")]),s._v(" "),a("p",[a("strong",[s._v("删除数据卷：")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" volume "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" nlrx\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("如果被删除的数据卷正在被某个运行中的容器所使用时，那么此时 "),a("code",[s._v("docker")]),s._v(" 会提示当前数据卷正在被使用，不能删除。如下：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v(" ~ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" volume "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" nlrx\nError response from daemon: remove nlrx: volume is "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" use - "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("3ecf36332a8cb63b12af5b4ee13491338839b2f27311cdcc1e6c5d5499dd2e26"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("需要先将正在使用这个数据卷的容器停止后，才能删除。")]),s._v(" "),a("p",[a("strong",[s._v("删除无主数据卷：")])]),s._v(" "),a("p",[s._v("当一个数据卷没有被任何容器使用时，此时该数据卷就变成了「无主数据卷」，如果想要快速删除所有的无主数据卷时，可以使用 "),a("code",[s._v("prune")]),s._v(" 命令，如下：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" volume prune\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h2",{attrs:{id:"将数据卷挂载到容器里"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#将数据卷挂载到容器里"}},[s._v("#")]),s._v(" 将数据卷挂载到容器里")]),s._v(" "),a("p",[s._v("在使用 "),a("code",[s._v("docker run")]),s._v(" 命令启动容器的时候，可以使用 "),a("code",[s._v("--mount")]),s._v(" 来将数据卷挂载到容器里。在一次 "),a("code",[s._v("docker run")]),s._v(" 中可以挂载多个数据卷。")]),s._v(" "),a("p",[s._v("创建一个名为 "),a("code",[s._v("web")]),s._v(" 的容器，并加载一个数据卷到容器的 "),a("code",[s._v("/usr/share/nginx/html")]),s._v(" 目录。如下：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),s._v(" web "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8081")]),s._v(":80 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--mount")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("source")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nlrx,target"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/share/nginx/html "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" nginx:alpine\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("此时，打开浏览器访问 "),a("code",[s._v("127.0.0.1:8081")]),s._v(" ，如果出现了 "),a("code",[s._v("nginx")]),s._v(" 的欢迎页面，则表示容器启动成功。")]),s._v(" "),a("p",[s._v("此时，我们还可以查看一下改容器的具体信息，如下：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v(" ~ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" inspect web\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# 数据卷信息在 "Mounts" 下面')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Mounts"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Type"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"volume"')]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Source"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nlrx"')]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Target"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/usr/share/nginx/html"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(",\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("p",[s._v("接着，我们可以进到容器卷里面，如下：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /var/lib/docker/volumes/nlrx/_data\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("并尝试修改容器卷里的 "),a("code",[s._v("index.html")]),s._v(" 文件内容，保存并刷新浏览器就可以看到数据卷内容的变更已经应用到容器里了。")]),s._v(" "),a("h2",{attrs:{id:"在mac-os中-卷默认挂载路径不存在问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#在mac-os中-卷默认挂载路径不存在问题"}},[s._v("#")]),s._v(" 在Mac OS中，卷默认挂载路径不存在问题")]),s._v(" "),a("p",[s._v("在 "),a("code",[s._v("Mac OS")]),s._v(" 中，使用 "),a("code",[s._v("docker volume create nlrx")]),s._v(" 创建完数据卷后，此时访问数据卷的挂载路径 "),a("code",[s._v("/var/lib/docker/volumes/nlrx/_data")]),s._v(" 时，会提示该路径不存在，解决方法如下：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-it")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--privileged")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--pid")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("host justincormack/nsenter1\n\nUnable to "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("find")]),s._v(" image "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'justincormack/nsenter1:latest'")]),s._v(" locally\nlatest: Pulling from justincormack/nsenter1\n5bc638ae6f98: Pull complete \nDigest: sha256:e876f694a4cb6ff9e6861197ea3680fe2e3c5ab773a1e37ca1f13171f7f5798e\nStatus: Downloaded newer image "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" justincormack/nsenter1:latest\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在这里可查看挂载路径")]),s._v("\n/ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /var/lib/docker/volumes/nlrx/_data\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])])])}),[],!1,null,null,null);a.default=e.exports}}]);